{"version":3,"file":"levels.js","sources":["../src/levels.js"],"sourcesContent":["import _ from 'lodash';\nimport * as defaults from './defaults';\nimport text from './text';\nimport { BadOptionsError } from './error';\n\n// level numbers\nexport const isNumberValid = n =>\nNumber.isInteger(parseFloat(n)) && _.inRange(n, 8);\n\n/**\n * Normalize the array\n * @param arr\n * @param opts\n * @returns {*}\n */\nconst normArr = (arr, opts) => {\n  if (arr.length > 8) {\n    throw new BadOptionsError(opts, text.tooManyLevels(arr.length));\n  }\n\n  return arr.map(val => {\n    if (val && _.isString(val)) return val;\n    if (_.isNumber(val) && isFinite(val)) return val.toString();\n    if (_.isNull(val) || _.isUndefined(val)) return undefined;\n\n    throw new BadOptionsError(opts, text.levelNotString(val));\n  });\n};\n\n\n/**\n * Normalize the object\n * @param obj\n * @param opts\n */\nconst normObj = (obj, opts) => {\n  const lvlNums = _.values(obj);\n\n  for (const num of lvlNums) {\n    if (!isNumberValid(num)) {\n      throw new BadOptionsError(opts, text.invalidLevelNum(num));\n    }\n  }\n\n  const duplicates =\n      _(obj).countBy().pick(lvl => lvl > 1)\n          .keys()\n          .value();\n\n  if (duplicates.length) {\n    throw new BadOptionsError(opts, text.duplicateLevelNums(duplicates));\n  }\n\n  return _.reduce(obj, (arr, i, name) => {\n    const reducedArr = arr;\n    reducedArr[i] = name;\n    return reducedArr;\n  }, []);\n};\n\n/**\n * Main normalize function to export.\n * @param opts\n * @returns {*}\n */\nexport const normalize = (opts) => {\n  let custom = opts.levels;\n\n  if (!_.isUndefined(custom) && !_.isNull(custom) && !_.isObject(custom)) {\n    throw new BadOptionsError(opts, text.levelsNotObj(typeof custom));\n  }\n\n  if (!custom) {\n    return defaults.levels.slice();\n  }\n\n  custom = Array.isArray(custom) ? normArr(custom, opts) : normObj(custom, opts);\n\n  const levels = defaults.levels.map((lvl, i) => custom[i] || lvl);\n\n  const duplicates =\n      _(levels).countBy().pick(count => count > 1)\n          .keys()\n          .value();\n\n  if (duplicates.length) {\n    throw new BadOptionsError(opts, text.duplicateLevels(duplicates));\n  }\n\n  return levels;\n};\n"],"names":["levels","BadOptionsError","opts","text","duplicateLevels","duplicates","length","keys","value","count","countBy","pick","custom","i","lvl","defaults","map","Array","isArray","normArr","normObj","slice","levelsNotObj","_","isUndefined","isNull","isObject","normalize","reducedArr","name","arr","reduce","obj","duplicateLevelNums","invalidLevelNum","num","isNumberValid","lvlNums","values","levelNotString","val","undefined","isNumber","isFinite","toString","isString","tooManyLevels","parseFloat","n","inRange"],"mappings":"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"}