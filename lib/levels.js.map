{"version":3,"file":"levels.js","sources":["../src/levels.js"],"sourcesContent":["import reduce from 'lodash.reduce';\nimport inRange from 'lodash.inrange';\nimport isObject from 'lodash.isobject';\nimport isString from 'lodash.isstring';\nimport isNumber from 'lodash.isnumber';\nimport isNull from 'lodash.isnull';\nimport isUndefined from 'lodash.isundefined';\nimport values from 'lodash.values';\nimport filter from 'lodash.filter';\nimport includes from 'lodash.includes';\nimport * as defaults from './defaults';\nimport text from './text';\nimport { BadOptionsError } from './error';\n\n// level numbers\nexport const isNumberValid = n =>\nNumber.isInteger(parseFloat(n)) && inRange(n, 8);\n\n/**\n * Normalize the array\n * @param arr\n * @param opts\n * @returns {*}\n */\nconst normArr = (arr, opts) => {\n  if (arr.length > 8) {\n    throw new BadOptionsError(opts, text.tooManyLevels(arr.length));\n  }\n\n  return arr.map(val => {\n    if (val && isString(val)) return val;\n    if (isNumber(val) && isFinite(val)) return val.toString();\n    if (isNull(val) || isUndefined(val)) return undefined;\n\n    throw new BadOptionsError(opts, text.levelNotString(val));\n  });\n};\n\n\n/**\n * Normalize the object\n * @param obj\n * @param opts\n */\nconst normObj = (obj, opts) => {\n  const lvlNums = values(obj);\n\n  for (const num of lvlNums) {\n    if (!isNumberValid(num)) {\n      throw new BadOptionsError(opts, text.invalidLevelNum(num));\n    }\n  }\n\n  const duplicates = filter(values(obj), (val, i, iteratee) => includes(iteratee, val, i + 1));\n  if (duplicates.length) {\n    throw new BadOptionsError(opts, text.duplicateLevelNums(duplicates));\n  }\n\n  return reduce(obj, (arr, i, name) => {\n    const reducedArr = arr;\n    reducedArr[i] = name;\n    return reducedArr;\n  }, []);\n};\n\n/**\n * Main normalize function to export.\n * @param opts\n * @returns {*}\n */\nexport const normalize = (opts) => {\n  let custom = opts.levels;\n\n  if (!isUndefined(custom) && !isNull(custom) && !isObject(custom)) {\n    throw new BadOptionsError(opts, text.levelsNotObj(typeof custom));\n  }\n\n  if (!custom) {\n    return defaults.levels.slice();\n  }\n\n  custom = Array.isArray(custom) ? normArr(custom, opts) : normObj(custom, opts);\n\n  const levels = defaults.levels.map((lvl, i) => custom[i] || lvl);\n\n  const duplicates = filter(values(levels), (val, i, iteratee) => includes(iteratee, val, i + 1));\n\n  if (duplicates.length) {\n    throw new BadOptionsError(opts, text.duplicateLevels(duplicates));\n  }\n\n  return levels;\n};\n"],"names":["levels","BadOptionsError","opts","text","duplicateLevels","duplicates","length","iteratee","val","i","custom","lvl","defaults","map","Array","isArray","normArr","normObj","slice","levelsNotObj","normalize","reducedArr","name","arr","obj","duplicateLevelNums","invalidLevelNum","num","isNumberValid","lvlNums","levelNotString","undefined","isFinite","toString","tooManyLevels","parseFloat","n"],"mappings":"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"}